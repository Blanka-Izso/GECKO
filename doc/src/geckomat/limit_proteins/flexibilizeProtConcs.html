<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of flexibilizeProtConcs</title>
  <meta name="keywords" content="flexibilizeProtConcs">
  <meta name="description" content="flexibilizeProtConcs">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="#">src</a> &gt; <a href="#">geckomat</a> &gt; <a href="index.html">limit_proteins</a> &gt; flexibilizeProtConcs.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for src/geckomat/limit_proteins&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>flexibilizeProtConcs
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>flexibilizeProtConcs</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [model, flexProt] = flexibilizeProtConcs(model, expGrowth, foldChange, iterPerEnzyme, modelAdapter, verbose) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> flexibilizeProtConcs
   Flexibilize protein concentration of an ecModel with constrained with
   proteomics data. The upper bound of the protein usage reaction is
   changed, while the concentrations in ecModel.ec.concs remain unchanged.
   If no (more) limiting enzyme concentrations can be found, an attempt
   will be made to relax the protein pool exchange reaction. If this does
   increase the growth rate, it is encouraged to set the protein pool
   exchange unconstrained before running flexibilizeProtConcs. If relaxing
   the protein pool exchange does not increase the growth rate, then this
   is not due to enzyme constraints, but rather an issue with the
   metabolic network itself, or the set nutrient exchange is not
   sufficient.

 Input:
   model           an ecModel in GECKO 3 format (with ecModel.ec structure)
   expGrowth       estimated experimental growth rate. If not specified,
                   the value will be read from the model adapter
   foldChange      a value how much increase the protein concentration
                   (Optional, default = 2)
   iterPerEnzyme   the number of iterations that an enzyme can be increased.
                   A zero number can be defined. if zero is defined no limit
                   will be set, and it will increase the protein concentration
                   until reach de defined growth rate (Optional, default = 5)
   modelAdapter    a loaded model adapter (Optional, will otherwise use the
                   default model adapter)
   verbose         logical whether progress should be reported (Optional,
                   default true)

 Output:
   model           ecModel where the UB of measured protein have been increased
                   to allow reach a defined growth rate
   flexProt        array with information about flexibilized proteins
                   uniprotIDs  enzymes whose usage UB was flexibilized
                   oldConcs    original concentrations, from mode.ec.concs
                   flexConcs   flexibilized concentrations, new UB in
                               model
                   frequence   numeric how often the enzyme has been
                               step-wise flexibilized

 Usage:
   [model, flexProt] = flexibilizeProtConcs(model, expGrowth, foldChange, iterPerEnzyme, modelAdapter, verbose)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="getConcControlCoeffs.html" class="code" title="function [enz, controlCoeffs] = getConcControlCoeffs(model, proteins, foldChange, limit)">getConcControlCoeffs</a>	getConcControlCoeffs</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [model, flexProt] = flexibilizeProtConcs(model, expGrowth, foldChange, iterPerEnzyme, modelAdapter, verbose)</a>
0002 <span class="comment">% flexibilizeProtConcs</span>
0003 <span class="comment">%   Flexibilize protein concentration of an ecModel with constrained with</span>
0004 <span class="comment">%   proteomics data. The upper bound of the protein usage reaction is</span>
0005 <span class="comment">%   changed, while the concentrations in ecModel.ec.concs remain unchanged.</span>
0006 <span class="comment">%   If no (more) limiting enzyme concentrations can be found, an attempt</span>
0007 <span class="comment">%   will be made to relax the protein pool exchange reaction. If this does</span>
0008 <span class="comment">%   increase the growth rate, it is encouraged to set the protein pool</span>
0009 <span class="comment">%   exchange unconstrained before running flexibilizeProtConcs. If relaxing</span>
0010 <span class="comment">%   the protein pool exchange does not increase the growth rate, then this</span>
0011 <span class="comment">%   is not due to enzyme constraints, but rather an issue with the</span>
0012 <span class="comment">%   metabolic network itself, or the set nutrient exchange is not</span>
0013 <span class="comment">%   sufficient.</span>
0014 <span class="comment">%</span>
0015 <span class="comment">% Input:</span>
0016 <span class="comment">%   model           an ecModel in GECKO 3 format (with ecModel.ec structure)</span>
0017 <span class="comment">%   expGrowth       estimated experimental growth rate. If not specified,</span>
0018 <span class="comment">%                   the value will be read from the model adapter</span>
0019 <span class="comment">%   foldChange      a value how much increase the protein concentration</span>
0020 <span class="comment">%                   (Optional, default = 2)</span>
0021 <span class="comment">%   iterPerEnzyme   the number of iterations that an enzyme can be increased.</span>
0022 <span class="comment">%                   A zero number can be defined. if zero is defined no limit</span>
0023 <span class="comment">%                   will be set, and it will increase the protein concentration</span>
0024 <span class="comment">%                   until reach de defined growth rate (Optional, default = 5)</span>
0025 <span class="comment">%   modelAdapter    a loaded model adapter (Optional, will otherwise use the</span>
0026 <span class="comment">%                   default model adapter)</span>
0027 <span class="comment">%   verbose         logical whether progress should be reported (Optional,</span>
0028 <span class="comment">%                   default true)</span>
0029 <span class="comment">%</span>
0030 <span class="comment">% Output:</span>
0031 <span class="comment">%   model           ecModel where the UB of measured protein have been increased</span>
0032 <span class="comment">%                   to allow reach a defined growth rate</span>
0033 <span class="comment">%   flexProt        array with information about flexibilized proteins</span>
0034 <span class="comment">%                   uniprotIDs  enzymes whose usage UB was flexibilized</span>
0035 <span class="comment">%                   oldConcs    original concentrations, from mode.ec.concs</span>
0036 <span class="comment">%                   flexConcs   flexibilized concentrations, new UB in</span>
0037 <span class="comment">%                               model</span>
0038 <span class="comment">%                   frequence   numeric how often the enzyme has been</span>
0039 <span class="comment">%                               step-wise flexibilized</span>
0040 <span class="comment">%</span>
0041 <span class="comment">% Usage:</span>
0042 <span class="comment">%   [model, flexProt] = flexibilizeProtConcs(model, expGrowth, foldChange, iterPerEnzyme, modelAdapter, verbose)</span>
0043 
0044 <span class="keyword">if</span> nargin &lt; 6 || isempty(verbose)
0045     verbose = true;
0046 <span class="keyword">end</span>
0047 <span class="keyword">if</span> nargin &lt; 5 || isempty(modelAdapter)
0048     modelAdapter = ModelAdapterManager.getDefaultAdapter();
0049     <span class="keyword">if</span> isempty(modelAdapter)
0050         error(<span class="string">'Either send in a modelAdapter or set the default model adapter in the ModelAdapterManager.'</span>)
0051     <span class="keyword">end</span>
0052 <span class="keyword">end</span>
0053 params = modelAdapter.getParameters();
0054 
0055 <span class="keyword">if</span> nargin &lt; 4 || isempty(iterPerEnzyme)
0056     iterPerEnzyme = 5;
0057 <span class="keyword">end</span>
0058 
0059 <span class="keyword">if</span> nargin &lt; 3 || isempty(foldChange)
0060     foldChange = 2;
0061 <span class="keyword">end</span>
0062 
0063 <span class="keyword">if</span> nargin &lt; 2 || isempty(expGrowth)
0064     expGrowth = modelAdapter.getParameters().gR_exp;
0065 <span class="keyword">end</span>
0066 
0067 <span class="comment">% If a zero value is defined, not iteration limit will be set</span>
0068 <span class="keyword">if</span> iterPerEnzyme == 0
0069     iterPerEnzyme = inf;
0070 <span class="keyword">end</span>
0071 
0072 bioRxnIdx = getIndexes(model,params.bioRxn,<span class="string">'rxns'</span>);
0073 <span class="keyword">if</span> model.ub(bioRxnIdx) &lt; expGrowth
0074     fprintf([<span class="string">'The upper bound of the biomass reaction was %s, while expGrowth '</span><span class="keyword">...</span>
0075              <span class="string">'is %s. The upper bound has been set to expGrowth.'</span>],<span class="keyword">...</span>
0076              num2str(model.ub(bioRxnIdx)), num2str(expGrowth))
0077     model.ub(bioRxnIdx) = expGrowth;
0078 <span class="keyword">end</span>
0079 
0080 <span class="comment">% Keep track if protein pool will be flexibilized</span>
0081 changedProtPool = false;
0082 
0083 <span class="comment">% In case the model have not been protein constrained</span>
0084 <span class="comment">% model = constrainProtConcs(model);</span>
0085 
0086 [sol,hs] = solveLP(model);
0087 predGrowth = abs(sol.f);
0088 
0089 <span class="comment">% Get those proteins with a concentration defined</span>
0090 protConcs = find(~isnan(model.ec.concs));
0091 
0092 <span class="comment">% Get enzymes names with a concentration value</span>
0093 proteins = model.ec.enzymes(protConcs);
0094 
0095 <span class="comment">% Store how many time is predicted a enzyme with the highest coeff</span>
0096 frequence = zeros(numel(proteins),1);
0097 
0098 flexBreak=false;
0099 <span class="keyword">if</span> any(protConcs)
0100     <span class="keyword">while</span> predGrowth &lt; expGrowth
0101 
0102         <span class="comment">% Get the control coefficients</span>
0103         [~, controlCoeffs] = <a href="getConcControlCoeffs.html" class="code" title="function [enz, controlCoeffs] = getConcControlCoeffs(model, proteins, foldChange, limit)">getConcControlCoeffs</a>(model, proteins, foldChange, 0.75);
0104 
0105         <span class="comment">% Stop looking for limiting proteins all coeffs are zero</span>
0106         <span class="keyword">if</span> any(controlCoeffs)
0107 
0108             <span class="comment">% Find the maximum coefficient index</span>
0109             [~,maxIdx] = max(controlCoeffs);
0110 
0111             <span class="comment">% Increase +1 the frequence</span>
0112             frequence(maxIdx) = frequence(maxIdx) + 1;
0113 
0114             <span class="comment">% Allow to increase the UB maximum five times</span>
0115             <span class="keyword">if</span> frequence(maxIdx) &lt;= iterPerEnzyme
0116 
0117                 <span class="comment">% Set how much will increase the UB</span>
0118                 increase = foldChange*frequence(maxIdx);
0119 
0120                 <span class="comment">% Get usage rxn for the highest coeff</span>
0121                 protUsageIdx = strcmpi(model.rxns, strcat(<span class="string">'usage_prot_'</span>, proteins(maxIdx)));
0122 
0123                 <span class="comment">% replace the UB</span>
0124                 model.lb(protUsageIdx) = -(model.ec.concs(protConcs(maxIdx)) * (1+increase));
0125 
0126                 <span class="comment">% Get the new growth rate</span>
0127                 sol = solveLP(model,0,[],hs);
0128                 predGrowth = abs(sol.f);
0129 
0130                 <span class="keyword">if</span> verbose
0131                     disp([<span class="string">'Protein '</span> proteins{maxIdx} <span class="string">' LB adjusted. Grow: '</span> num2str(predGrowth)])
0132                 <span class="keyword">end</span>
0133             <span class="keyword">else</span>
0134                 disp([<span class="string">'Limit has been reached. Protein '</span>  proteins{maxIdx} <span class="string">' seems to be problematic. Consider changing the kcat.'</span>])
0135                 flexBreak=true;
0136                 <span class="keyword">break</span>
0137             <span class="keyword">end</span>
0138         <span class="keyword">else</span>
0139             disp(<span class="string">'No (more) limiting proteins have been found. Attempt to increase protein pool exchange.'</span>)
0140             protPoolIdx = getIndexes(model,<span class="string">'prot_pool_exchange'</span>,<span class="string">'rxns'</span>);
0141             oldProtPool = -model.lb(protPoolIdx);
0142             tempModel = setParam(model,<span class="string">'lb'</span>,protPoolIdx,-1000);
0143             tempModel = setParam(tempModel,<span class="string">'ub'</span>,bioRxnIdx,expGrowth);
0144             sol = solveLP(tempModel);
0145             <span class="keyword">if</span> (abs(sol.f)-predGrowth)&gt;1e-10 <span class="comment">% There is improvement in growth rate</span>
0146                 <span class="comment">% Find new protein pool constraint</span>
0147                 predGrowth = abs(sol.f);
0148                 tempModel = setParam(tempModel,<span class="string">'lb'</span>,bioRxnIdx,predGrowth);
0149                 tempModel = setParam(tempModel,<span class="string">'obj'</span>,protPoolIdx,1);
0150                 sol = solveLP(tempModel);
0151                 newProtPool = abs(sol.f);
0152                 model.lb(protPoolIdx) = -newProtPool;
0153                 fprintf([<span class="string">'Changing the lower bound of protein pool exchange from %s '</span>,<span class="keyword">...</span>
0154                          <span class="string">'to %s enabled a\ngrowth rate of %s. It can be helpful to set '</span>, <span class="keyword">...</span>
0155                          <span class="string">'the lower bound of protein\npool exchange to -1000 before '</span>,<span class="keyword">...</span>
0156                          <span class="string">'running flexibilizeProtConcs.\n'</span>],num2str(-oldProtPool), <span class="keyword">...</span>
0157                          num2str(-newProtPool),num2str(predGrowth));
0158                 changedProtPool = true;
0159             <span class="keyword">else</span>
0160                 fprintf([<span class="string">'Protein pool exchange not limiting. Inability to reach growth '</span>,<span class="keyword">...</span>
0161                         <span class="string">'rate is not related to\nenzyme constraints. Maximum growth rate '</span>,<span class="keyword">...</span>
0162                         <span class="string">'is %s.\n'</span>], num2str(predGrowth))
0163             <span class="keyword">end</span>
0164             <span class="comment">% To return an usable model with these conditions, set the</span>
0165             <span class="comment">% highest growth rate reached as the experimental value</span>
0166             expGrowth = predGrowth;
0167             <span class="keyword">break</span>
0168         <span class="keyword">end</span>
0169     <span class="keyword">end</span>
0170 <span class="keyword">else</span>
0171     error(<span class="string">'Protein concentrations have not been defined. Please run readProteomics and constrainProtConcs'</span>)
0172 <span class="keyword">end</span>
0173 
0174 protFlex        = proteins(frequence&gt;0);
0175 protUsageIdx    = find(ismember(model.rxns, strcat(<span class="string">'usage_prot_'</span>, protFlex)));
0176 ecProtId        = find(ismember(model.ec.enzymes,protFlex));
0177 oldConcs        = model.ec.concs(ecProtId);
0178 
0179 <span class="keyword">if</span> flexBreak == false &amp;&amp; ~isempty(protFlex)
0180     <span class="comment">% Not all flexibilized proteins require flexibilization in the end</span>
0181     <span class="comment">% Test flux distribution with minimum prot_pool usage</span>
0182     modelTemp       = setParam(model,<span class="string">'var'</span>,params.bioRxn,expGrowth,0.5);
0183     modelTemp       = setParam(modelTemp,<span class="string">'obj'</span>,<span class="string">'prot_pool_exchange'</span>,1);
0184     sol             = solveLP(modelTemp,1);
0185     <span class="comment">% Check which concentrations can remain unchanged</span>
0186     newConcs        = abs(sol.x(protUsageIdx));
0187     keepOld         = newConcs&lt;oldConcs;
0188     <span class="comment">% Set UBs</span>
0189     model.lb(protUsageIdx(keepOld))  = -oldConcs(keepOld);
0190     model.lb(protUsageIdx(~keepOld)) = -newConcs(~keepOld);
0191     <span class="comment">% Output structure</span>
0192     protFlex(keepOld) = [];
0193     oldConcs(keepOld) = [];
0194     newConcs(keepOld) = [];
0195     frequence=frequence(frequence&gt;0);
0196     frequence(keepOld) = [];
0197     
0198     flexProt.uniprotIDs = protFlex;
0199     flexProt.oldConcs   = oldConcs;
0200     flexProt.flexConcs  = newConcs;
0201     flexProt.frequence  = frequence(frequence&gt;0);
0202 <span class="keyword">else</span>
0203     protFlex        = proteins(frequence&gt;0);
0204     protUsageIdx    = find(ismember(model.rxns, strcat(<span class="string">'usage_prot_'</span>, protFlex)));
0205 
0206     flexProt.uniprotIDs = protFlex;
0207     flexProt.oldConcs   = model.ec.concs(ecProtId);
0208     flexProt.flexConcs  = abs(model.lb(protUsageIdx));
0209     flexProt.frequence  = frequence(frequence&gt;0);
0210 <span class="keyword">end</span>
0211 <span class="keyword">if</span> changedProtPool
0212     flexProt.uniprotIDs(end+1) = {<span class="string">'prot_pool'</span>};
0213     flexProt.oldConcs(end+1)   = oldProtPool;
0214     flexProt.flexConcs(end+1)  = newProtPool;
0215     flexProt.frequence(end+1)  = 1;
0216 <span class="keyword">end</span>
0217 <span class="keyword">end</span></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>