<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of ecFlux_scanning</title>
  <meta name="keywords" content="ecFlux_scanning">
  <meta name="description" content="ecFlux_scanning">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../index.html">Home</a> &gt;  <a href="#">src</a> &gt; <a href="#">geckomat</a> &gt; <a href="../index.html">utilities</a> &gt; <a href="index.html">ecFSEOF</a> &gt; ecFlux_scanning.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../index.html"><img alt="<" border="0" src="../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for src/geckomat/utilities/ecFSEOF&nbsp;<img alt=">" border="0" src="../../../../right.png"></a></td></tr></table>-->

<h1>ecFlux_scanning
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>ecFlux_scanning</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function FC = ecFlux_scanning(model,target,C_source,alpha,tol,filterG) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">ecFlux_scanning

       model     (struct) ecModel with total protein pool constraint.
                 the model should come with growth pseudoreaction as 
                 an objective to maximize.
       target    (string) Rxn ID for the production target reaction, 
                 a exchange reaction is recommended.
       cSource   (string) Rxn ID for the main carbon source uptake 
                 reaction
       alpha     (dobule) scalling factor for production yield 
                 for enforced objective limits
       tol       (double, optional) numerical tolerance for fixing 
                   bounds
        filterG      (logical) TRUE if genes K_scores results should
                  be filtered according to the alpha vector distribution

 Usage:  FC = compare_substrate(model,target,C_source,alpha,tol,filterG)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="run_ecFSEOF.html" class="code" title="function results = run_ecFSEOF(model,rxnTarget,cSource,alphaLims,Nsteps,file1,file2)">run_ecFSEOF</a>	</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function FC = ecFlux_scanning(model,target,C_source,alpha,tol,filterG)</a>
0002 <span class="comment">%ecFlux_scanning</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%       model     (struct) ecModel with total protein pool constraint.</span>
0005 <span class="comment">%                 the model should come with growth pseudoreaction as</span>
0006 <span class="comment">%                 an objective to maximize.</span>
0007 <span class="comment">%       target    (string) Rxn ID for the production target reaction,</span>
0008 <span class="comment">%                 a exchange reaction is recommended.</span>
0009 <span class="comment">%       cSource   (string) Rxn ID for the main carbon source uptake</span>
0010 <span class="comment">%                 reaction</span>
0011 <span class="comment">%       alpha     (dobule) scalling factor for production yield</span>
0012 <span class="comment">%                 for enforced objective limits</span>
0013 <span class="comment">%       tol       (double, optional) numerical tolerance for fixing</span>
0014 <span class="comment">%                   bounds</span>
0015 <span class="comment">%        filterG      (logical) TRUE if genes K_scores results should</span>
0016 <span class="comment">%                  be filtered according to the alpha vector distribution</span>
0017 <span class="comment">%</span>
0018 <span class="comment">% Usage:  FC = compare_substrate(model,target,C_source,alpha,tol,filterG)</span>
0019 <span class="comment">%</span>
0020 
0021 <span class="keyword">if</span> nargin&lt;6
0022     filterG = false;
0023 <span class="keyword">end</span>
0024 
0025 <span class="comment">%Simulate WT (100% growth):</span>
0026 cd ..
0027 FC.flux_WT = simulateGrowth(model,target,C_source,1,1);
0028 <span class="comment">%Simulate forced (X% growth and the rest towards product) based on yield:</span>
0029 FC.alpha = alpha;
0030 <span class="comment">%initialize fluxes and K_scores matrices</span>
0031 v_matrix = zeros(length(model.rxns),length(alpha));
0032 k_matrix = zeros(length(model.rxns),length(alpha));
0033 <span class="keyword">for</span> i = 1:length(alpha)
0034     <span class="comment">%disp(['Iteration #' num2str(i)])</span>
0035     FC.flux_MAX   = simulateGrowth(model,target,C_source,1,alpha(i));
0036     v_matrix(:,i) = FC.flux_MAX;
0037     k_matrix(:,i) = FC.flux_MAX./FC.flux_WT;
0038 <span class="keyword">end</span>
0039 cd ecFSEOF
0040 <span class="comment">%Take out rxns with no grRule:</span>
0041 withGR   = ~cellfun(@isempty,model.grRules);
0042 <span class="comment">%Generate rxn equations:</span>
0043 rxnEqs   = constructEquations(model,model.rxns(withGR),true);
0044 v_matrix = v_matrix(withGR,:);
0045 k_matrix = k_matrix(withGR,:);
0046 rxnGeneM = model.rxnGeneMat(withGR,:);
0047 FC.rxns  = [model.rxns(withGR),model.rxnNames(withGR),model.grRules(withGR),rxnEqs];
0048 
0049 <span class="comment">%Filter out rxns that are always zero -&gt; k=0/0=NaN:</span>
0050 non_nan  = sum(~isnan(k_matrix),2) &gt; 0;
0051 v_matrix = v_matrix(non_nan,:);
0052 k_matrix = k_matrix(non_nan,:);
0053 rxnGeneM = rxnGeneM(non_nan,:);
0054 FC.rxns  = FC.rxns(non_nan,:);
0055 
0056 <span class="comment">%Replace remaining NaNs with 1s:</span>
0057 k_matrix(isnan(k_matrix)) = 1;
0058 <span class="comment">%Replace any Inf value with 1000 (maximum value is ~700):</span>
0059 k_matrix(k_matrix&gt;1000) = 1000;
0060 
0061 <span class="comment">%Filter out values that are inconsistent at different alphas:</span>
0062 always_down  = sum(k_matrix &lt;= (1-tol),2) == length(alpha);
0063 always_up    = sum(k_matrix &gt;= (1+tol),2) == length(alpha);
0064 <span class="comment">%Identify those reactions with mixed patterns</span>
0065 incons_rxns  = always_down + always_up == 0;
0066 <span class="comment">%Identify genes that are linked to &quot;inconsistent rxns&quot;</span>
0067 incons_genes = sum(rxnGeneM(incons_rxns,:),1) &gt; 0;
0068 <span class="comment">%Finally, inconsistent reactions are those that are not conected</span>
0069 <span class="comment">%to &quot;inconsistent genes&quot; from the original &quot;inconsistent rxns&quot; set</span>
0070 incons_rxns  = sum(rxnGeneM(:,incons_genes),2) &gt; 0;
0071 <span class="comment">%Keep results for the consistent rxns exclusively</span>
0072 v_matrix     = v_matrix(~incons_rxns,:);
0073 k_matrix     = k_matrix(~incons_rxns,:);
0074 rxnGeneM     = rxnGeneM(~incons_rxns,:);
0075 FC.rxns      = FC.rxns(~incons_rxns,:);
0076 <span class="comment">%Get median k score across steps</span>
0077 FC.k_rxns   = mean(k_matrix,2);
0078 <span class="comment">%Remove arm_rxns from the list of rxns with K_score&gt;1</span>
0079 armUP       = startsWith(FC.rxns(:,1),<span class="string">'arm_'</span>) &amp; FC.k_rxns&gt;1;
0080 FC.k_rxns   = FC.k_rxns(~armUP,:);
0081 FC.v_matrix = v_matrix(~armUP,:);
0082 FC.k_matrix = k_matrix(~armUP,:);
0083 rxnGeneM    = rxnGeneM(~armUP,:);
0084 FC.rxns     = FC.rxns(~armUP,:);
0085 
0086 <span class="comment">%Order from highest to lowest median k_score (across alphas)</span>
0087 [~,order]   = sort(FC.k_rxns,<span class="string">'descend'</span>);
0088 FC.k_rxns   = FC.k_rxns(order,:);
0089 FC.v_matrix = v_matrix(order,:);
0090 FC.k_matrix = k_matrix(order,:);
0091 rxnGeneM    = rxnGeneM(order,:);
0092 FC.rxns     = FC.rxns(order,:);
0093 <span class="comment">%Create list of remaining genes and filter out any inconsistent score:</span>
0094 <span class="comment">%Just those genes that are connected to the remaining rxns are</span>
0095 FC.genes     = model.genes(sum(rxnGeneM,1) &gt; 0);
0096 FC.geneNames = model.geneShortNames(sum(rxnGeneM,1) &gt; 0);
0097 FC.k_genes   = zeros(size(FC.genes));
0098 cons_genes   = false(size(FC.genes));
0099 rxnGeneM     = rxnGeneM(:,sum(rxnGeneM,1) &gt; 0);
0100 
0101 <span class="keyword">for</span> i = 1:length(FC.genes)
0102     <span class="comment">%Extract all the K_scores (from rxns across alphas) conected to</span>
0103     <span class="comment">%each remaining gene</span>
0104     k_set         = FC.k_rxns(rxnGeneM(:,i) &gt; 0);
0105     <span class="comment">%Check the kind of control that gene i-th exerts over its reactions</span>
0106     always_down   = sum(k_set &lt;= (1-tol)) == length(k_set);
0107     always_up     = sum(k_set &gt;= (1+tol)) == length(k_set);
0108     <span class="comment">%Evaluate if gene is always exerting either a positive or negative</span>
0109     <span class="comment">%control</span>
0110     cons_genes(i) = always_down + always_up == 1;
0111     FC.k_genes(i) = mean(k_set);
0112 <span class="keyword">end</span>
0113 <span class="comment">%Keep &quot;consistent genes&quot;</span>
0114 FC.genes     = FC.genes(cons_genes);
0115 FC.geneNames = FC.geneNames(cons_genes);
0116 FC.k_genes   = FC.k_genes(cons_genes);
0117 rxnGeneM     = rxnGeneM(:,cons_genes);
0118 
0119 <span class="keyword">if</span> filterG
0120     <span class="comment">%Filter any value between mean(alpha) and 1:</span>
0121     unchanged    = (FC.k_genes &gt;= mean(alpha) - tol) + (FC.k_genes &lt;= 1 + tol) == 2;
0122     FC.genes     = FC.genes(~unchanged);
0123     FC.geneNames = FC.geneNames(~unchanged);
0124     FC.k_genes   = FC.k_genes(~unchanged);
0125     rxnGeneM     = rxnGeneM(:,~unchanged);
0126     <span class="comment">%Update results for rxns-related fields (remove remaining reactions</span>
0127     <span class="comment">%without any associated gene in rxnGeneM)</span>
0128     toKeep      = (sum(rxnGeneM,2) &gt; 0);
0129     FC.k_rxns   = FC.k_rxns(toKeep,:);
0130     FC.v_matrix = v_matrix(toKeep,:);
0131     FC.k_matrix = k_matrix(toKeep,:);
0132     FC.rxns     = FC.rxns(toKeep,:);
0133 <span class="keyword">end</span>
0134 
0135 <span class="comment">%Order from highest to lowest k:</span>
0136 [~,order]    = sort(FC.k_genes,<span class="string">'descend'</span>);
0137 FC.genes     = FC.genes(order,:);
0138 FC.geneNames = FC.geneNames(order,:);
0139 FC.k_genes   = FC.k_genes(order,:);
0140 
0141 <span class="keyword">end</span></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>