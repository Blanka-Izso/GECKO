<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of sensitivityTuning</title>
  <meta name="keywords" content="sensitivityTuning">
  <meta name="description" content="sensitivityTuning">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="#">src</a> &gt; <a href="#">geckomat</a> &gt; <a href="index.html">kcat_sensitivity_analysis</a> &gt; sensitivityTuning.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for src/geckomat/kcat_sensitivity_analysis&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>sensitivityTuning
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>sensitivityTuning</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [model, tunedKcats] = sensitivityTuning(model, desiredGrowthRate, modelAdapter, foldChange, verbose) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> sensitivityTuning
    Function that relaxes the most limiting kcats until a certain growth rate
    is reached. The function will update kcats in model.ec.kcat.

 Input:
   model              an ecModel in GECKO 3 format (with ecModel.ec structure)
   desiredGrowthRate  kcats will be relaxed until this growth rate is reached
   modelAdapter       a loaded model adapter (Optional, will otherwise use the
                      default model adapter).
   foldChange         kcat values will be increased by this fold-change.
                      (Opt, default 10)
   verbose            logical whether progress should be reported (Optional,
                      default true)

 Output:
   model              ecModel with updated model.ec.kcat
   tunedKcats         structure with information on tuned kcat values
                      rxns     identifiers of reactions with tuned kcat
                               values
                      rxnNames names of the reactions in tunedKcats.rxns
                      enzymes  enzymes that catalyze the reactions in
                               tunedKcats.rxns, whose kcat value has been
                               tuned.
                      oldKcat  kcat values in the input model
                      newKcat  kcat values in the output model, after tuning

 Usage:
   [model, tunedKcats] = sensitivityTuning(model, desiredGrowthRate, modelAdapter, foldChange, verbose)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [model, tunedKcats] = sensitivityTuning(model, desiredGrowthRate, modelAdapter, foldChange, verbose)</a>
0002 <span class="comment">% sensitivityTuning</span>
0003 <span class="comment">%    Function that relaxes the most limiting kcats until a certain growth rate</span>
0004 <span class="comment">%    is reached. The function will update kcats in model.ec.kcat.</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% Input:</span>
0007 <span class="comment">%   model              an ecModel in GECKO 3 format (with ecModel.ec structure)</span>
0008 <span class="comment">%   desiredGrowthRate  kcats will be relaxed until this growth rate is reached</span>
0009 <span class="comment">%   modelAdapter       a loaded model adapter (Optional, will otherwise use the</span>
0010 <span class="comment">%                      default model adapter).</span>
0011 <span class="comment">%   foldChange         kcat values will be increased by this fold-change.</span>
0012 <span class="comment">%                      (Opt, default 10)</span>
0013 <span class="comment">%   verbose            logical whether progress should be reported (Optional,</span>
0014 <span class="comment">%                      default true)</span>
0015 <span class="comment">%</span>
0016 <span class="comment">% Output:</span>
0017 <span class="comment">%   model              ecModel with updated model.ec.kcat</span>
0018 <span class="comment">%   tunedKcats         structure with information on tuned kcat values</span>
0019 <span class="comment">%                      rxns     identifiers of reactions with tuned kcat</span>
0020 <span class="comment">%                               values</span>
0021 <span class="comment">%                      rxnNames names of the reactions in tunedKcats.rxns</span>
0022 <span class="comment">%                      enzymes  enzymes that catalyze the reactions in</span>
0023 <span class="comment">%                               tunedKcats.rxns, whose kcat value has been</span>
0024 <span class="comment">%                               tuned.</span>
0025 <span class="comment">%                      oldKcat  kcat values in the input model</span>
0026 <span class="comment">%                      newKcat  kcat values in the output model, after tuning</span>
0027 <span class="comment">%</span>
0028 <span class="comment">% Usage:</span>
0029 <span class="comment">%   [model, tunedKcats] = sensitivityTuning(model, desiredGrowthRate, modelAdapter, foldChange, verbose)</span>
0030 
0031 <span class="keyword">if</span> nargin &lt; 5 || isempty(verbose)
0032     verbose = true;
0033 <span class="keyword">end</span>
0034 <span class="keyword">if</span> nargin &lt; 4 || isempty(foldChange)
0035     foldChange = 10;
0036 <span class="keyword">end</span>
0037 <span class="keyword">if</span> nargin &lt; 3 || isempty(modelAdapter)
0038     modelAdapter = ModelAdapterManager.getDefaultAdapter();
0039     <span class="keyword">if</span> isempty(modelAdapter)
0040         error(<span class="string">'Either send in a modelAdapter or set the default model adapter in the ModelAdapterManager.'</span>)
0041     <span class="keyword">end</span>
0042 <span class="keyword">end</span>
0043 params = modelAdapter.params;
0044 <span class="keyword">if</span> nargin &lt; 2 || isempty(desiredGrowthRate)
0045     desiredGrowthRate = params.gR_exp;
0046 <span class="keyword">end</span>
0047 
0048 kcatList = [];
0049 m = model;
0050 m.c = double(strcmp(m.rxns, params.bioRxn));<span class="comment">% Make sure that growth is maximized</span>
0051 
0052 [res,hs] = solveLP(m);
0053 <span class="keyword">if</span> isempty(res.x)
0054     error(<span class="string">'FBA of input model gives no valid result. Reduce protein pool constraint with setProtPoolSize and/or check if exchange constraints are correctly defined.'</span>)
0055 <span class="keyword">end</span>
0056 lastGrowth = 0;
0057 <span class="keyword">if</span> ~m.ec.geckoLight
0058     <span class="comment">%for the full model, we first find the draw reaction with the most flux</span>
0059     drawRxns = startsWith(m.rxns, <span class="string">'usage_prot_'</span>);
0060     iteration = 1;
0061     <span class="keyword">while</span> true
0062         [res,hs] = solveLP(m,0,[],hs); <span class="comment">%skip parsimonius, only takes time</span>
0063         <span class="keyword">if</span> (lastGrowth == -res.f)
0064             disp(<span class="string">'No growth increase from increased kcats - check if the constraints on the uptake reactions are too tight!'</span>)
0065             <span class="keyword">break</span>;
0066         <span class="keyword">end</span>
0067         lastGrowth = -res.f;
0068         <span class="keyword">if</span> (lastGrowth &gt;= desiredGrowthRate)
0069             <span class="keyword">break</span>;
0070         <span class="keyword">end</span>
0071         <span class="comment">%If you get an error here, it is likely due to numerical issues in the solver</span>
0072         <span class="comment">%The trick where we don't allow low kcats is to fix that, but maybe</span>
0073         <span class="comment">%it is not enough.</span>
0074         <span class="keyword">if</span> verbose; disp([<span class="string">'Iteration '</span> num2str(iteration) <span class="string">': Growth: '</span> num2str(lastGrowth)]); <span class="keyword">end</span>
0075         iteration            = iteration + 1;
0076         <span class="comment">%find the highest draw_prot rxn flux</span>
0077         drawFluxes           = zeros(length(drawRxns),1);
0078         drawFluxes(drawRxns) = res.x(drawRxns);
0079         [~,sel]              = min(drawFluxes); <span class="comment">% since bounds -1000 to 0</span>
0080         <span class="comment">%Now get the metabolite</span>
0081         metSel               = m.S(:,sel) &lt; 0; <span class="comment">% negative coeff</span>
0082         <span class="comment">%now find the reaction with the largest consumption of this protein</span>
0083         protFluxes           = m.S(metSel,:).' .* res.x; <span class="comment">%negative</span>
0084         [~,rxnSel]           = min(protFluxes);
0085         kcatList             = [kcatList, rxnSel];
0086         rxn                  = m.rxns(rxnSel);
0087         targetSubRxn         = strcmp(m.ec.rxns, rxn);
0088         m.ec.kcat(targetSubRxn) = m.ec.kcat(targetSubRxn) .* foldChange;
0089         m                    = applyKcatConstraints(m,targetSubRxn);
0090     <span class="keyword">end</span>
0091 
0092 <span class="keyword">else</span>
0093     origRxns = extractAfter(m.ec.rxns,4);
0094     iteration = 1;
0095     <span class="keyword">while</span> true
0096         res = solveLP(m,0); <span class="comment">%skip parsimonius, only takes time</span>
0097         <span class="keyword">if</span> (lastGrowth == -res.f)
0098             disp(<span class="string">'No growth increase from increased kcats - check if the constraints on the uptake reactions are too tight!'</span>)
0099             <span class="keyword">break</span>;
0100         <span class="keyword">end</span>
0101         lastGrowth = -res.f;
0102         <span class="keyword">if</span> (lastGrowth &gt;= desiredGrowthRate)
0103             <span class="keyword">break</span>;
0104         <span class="keyword">end</span>
0105         <span class="comment">%If you get an error here, it is likely due to numerical issues in the solver</span>
0106         <span class="comment">%The trick where we don't allow low kcats is to fix that, but maybe</span>
0107         <span class="comment">%it is not enough.</span>
0108         <span class="keyword">if</span> verbose; disp([<span class="string">'Iteration '</span> num2str(iteration) <span class="string">': Growth: '</span> num2str(lastGrowth)]); <span class="keyword">end</span>
0109         iteration       = iteration + 1;
0110         <span class="comment">%find the highest protein usage flux</span>
0111         protPoolStoich  = m.S(strcmp(m.mets, <span class="string">'prot_pool'</span>),:).';
0112         [~,sel]         = min(res.x .* protPoolStoich); <span class="comment">%max consumption</span>
0113         kcatList        = [kcatList, sel];
0114         rxn             = m.rxns(sel.');
0115         targetSubRxns   = strcmp(origRxns, rxn);
0116         m.ec.kcat(targetSubRxns) = m.ec.kcat(targetSubRxns) .* foldChange;
0117         m               = applyKcatConstraints(m,rxn);
0118     <span class="keyword">end</span>
0119 <span class="keyword">end</span>
0120 
0121 kcatList        = unique(kcatList);
0122 tunedKcats.rxns = m.rxns(kcatList);
0123 tunedKcats.rxnNames = m.rxnNames(kcatList);
0124 <span class="keyword">if</span> ~model.ec.geckoLight
0125     [~, rxnIdx]     = ismember(tunedKcats.rxns,m.ec.rxns);
0126 <span class="keyword">else</span>
0127     [~, rxnIdx]     = ismember(tunedKcats.rxns,origRxns);
0128 <span class="keyword">end</span>
0129 tunedKcats.enzymes  = cell(numel(kcatList),1);
0130 <span class="keyword">for</span> i=1:numel(rxnIdx)
0131     [~, metIdx]     = find(m.ec.rxnEnzMat(rxnIdx(i),:));
0132     tunedKcats.enzymes{i}   = strjoin(m.ec.enzymes(metIdx),<span class="string">';'</span>);
0133 <span class="keyword">end</span>
0134 tunedKcats.oldKcat  = model.ec.kcat(rxnIdx);
0135 tunedKcats.newKcat  = m.ec.kcat(rxnIdx);
0136 
0137 model = m;
0138 <span class="keyword">end</span></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>