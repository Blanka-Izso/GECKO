<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of applyCustomKcats</title>
  <meta name="keywords" content="applyCustomKcats">
  <meta name="description" content="applyCustomKcats">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="#">src</a> &gt; <a href="#">geckomat</a> &gt; <a href="index.html">change_model</a> &gt; applyCustomKcats.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for src/geckomat/change_model&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>applyCustomKcats
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>applyCustomKcats</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [model, rxnUpdated, notMatch] = applyCustomKcats(model, customKcats, modelAdapter) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> applyCustomKcats
   Apply user defined kcats.  Reads data/customKcats.tsv in the obj.params.path
   specified in the model adapter. Alternatively, a customKcats structure can
   provided, as specified below.

 Input:
   model           an ecModel in GECKO 3 format (with ecModel.ec structure)
   customKcats     structure with custom kcat information. If nothing
                   is provided, an attempt will be made to read
                   data/customKcats.tsv from the obj.params.path folder
                   specified in the modelAdapter.
   modelAdapter    a loaded model adapter (Optional, will otherwise use the
                   default model adapter).

 Output:
   model           ecModel where kcats for defined proteins have been
                   changed
   rxnUpdated      ids list of updated reactions, new kcats were applied
   notMatch        table with the list of reactions which the custom
                   information provided does not have full match (&gt; 50%)
                   based on GPR rules. Then, they are suggested to be
                   curated by the user

   customKcats structure:
   - proteins    protein identifiers, multiple for the same kcat (in case
                 of a protein complex) are separated by ' + '
   - genes       gene identifiers (optional, not used in matching)
   - gene_name   short gene name (optional, not used in matching)
   - kcat        new kcat value (one per entry)
   - rxns        reaction identifiers, multiple for the same kcat are
                 separated by ',' (optional, see below)
   - notes       will be appended to model.ec.notes (optional)
   - stoicho     complex stoichiometry, separated by ' + ' (examples: '1'
                 or '3 + 1'), matching the order in proteins field
   
   Either all reactions matching the set of proteins will have their kcat
   updated. Alternatively, a set of reactions can be defined for specific
   changes (e.g. r_0001). Reaction identifiers should be comma separated
   (e.g. r_0001, r_0002), and not contain the _REV and/or _EXP_1 suffices
   that makeEcModel introduces.

 Usage:
   [model, rxnUpdated, notMatch] = applyCustomKcats(model, customKcats, modelAdapter);</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="applyKcatConstraints.html" class="code" title="function model = applyKcatConstraints(model,updateRxns)">applyKcatConstraints</a>	applyKcatConstraints</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [model, rxnUpdated, notMatch] = applyCustomKcats(model, customKcats, modelAdapter)</a>
0002 <span class="comment">% applyCustomKcats</span>
0003 <span class="comment">%   Apply user defined kcats.  Reads data/customKcats.tsv in the obj.params.path</span>
0004 <span class="comment">%   specified in the model adapter. Alternatively, a customKcats structure can</span>
0005 <span class="comment">%   provided, as specified below.</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% Input:</span>
0008 <span class="comment">%   model           an ecModel in GECKO 3 format (with ecModel.ec structure)</span>
0009 <span class="comment">%   customKcats     structure with custom kcat information. If nothing</span>
0010 <span class="comment">%                   is provided, an attempt will be made to read</span>
0011 <span class="comment">%                   data/customKcats.tsv from the obj.params.path folder</span>
0012 <span class="comment">%                   specified in the modelAdapter.</span>
0013 <span class="comment">%   modelAdapter    a loaded model adapter (Optional, will otherwise use the</span>
0014 <span class="comment">%                   default model adapter).</span>
0015 <span class="comment">%</span>
0016 <span class="comment">% Output:</span>
0017 <span class="comment">%   model           ecModel where kcats for defined proteins have been</span>
0018 <span class="comment">%                   changed</span>
0019 <span class="comment">%   rxnUpdated      ids list of updated reactions, new kcats were applied</span>
0020 <span class="comment">%   notMatch        table with the list of reactions which the custom</span>
0021 <span class="comment">%                   information provided does not have full match (&gt; 50%)</span>
0022 <span class="comment">%                   based on GPR rules. Then, they are suggested to be</span>
0023 <span class="comment">%                   curated by the user</span>
0024 <span class="comment">%</span>
0025 <span class="comment">%   customKcats structure:</span>
0026 <span class="comment">%   - proteins    protein identifiers, multiple for the same kcat (in case</span>
0027 <span class="comment">%                 of a protein complex) are separated by ' + '</span>
0028 <span class="comment">%   - genes       gene identifiers (optional, not used in matching)</span>
0029 <span class="comment">%   - gene_name   short gene name (optional, not used in matching)</span>
0030 <span class="comment">%   - kcat        new kcat value (one per entry)</span>
0031 <span class="comment">%   - rxns        reaction identifiers, multiple for the same kcat are</span>
0032 <span class="comment">%                 separated by ',' (optional, see below)</span>
0033 <span class="comment">%   - notes       will be appended to model.ec.notes (optional)</span>
0034 <span class="comment">%   - stoicho     complex stoichiometry, separated by ' + ' (examples: '1'</span>
0035 <span class="comment">%                 or '3 + 1'), matching the order in proteins field</span>
0036 <span class="comment">%</span>
0037 <span class="comment">%   Either all reactions matching the set of proteins will have their kcat</span>
0038 <span class="comment">%   updated. Alternatively, a set of reactions can be defined for specific</span>
0039 <span class="comment">%   changes (e.g. r_0001). Reaction identifiers should be comma separated</span>
0040 <span class="comment">%   (e.g. r_0001, r_0002), and not contain the _REV and/or _EXP_1 suffices</span>
0041 <span class="comment">%   that makeEcModel introduces.</span>
0042 <span class="comment">%</span>
0043 <span class="comment">% Usage:</span>
0044 <span class="comment">%   [model, rxnUpdated, notMatch] = applyCustomKcats(model, customKcats, modelAdapter);</span>
0045 
0046 <span class="keyword">if</span> nargin &lt; 3 || isempty(modelAdapter)
0047     modelAdapter = ModelAdapterManager.getDefaultAdapter();
0048     <span class="keyword">if</span> isempty(modelAdapter)
0049         error(<span class="string">'Either send in a modelAdapter or set the default model adapter in the ModelAdapterManager.'</span>)
0050     <span class="keyword">end</span>
0051 <span class="keyword">end</span>
0052 
0053 params = modelAdapter.params;
0054 
0055 <span class="keyword">if</span> nargin&lt;2 || isempty(customKcats)
0056     customKcats = fullfile(params.path,<span class="string">'data'</span>,<span class="string">'customKcats.tsv'</span>);
0057 <span class="keyword">end</span>
0058 
0059 <span class="keyword">if</span> ~exist(customKcats, <span class="string">'file'</span>)
0060    error([<span class="string">'Custom kcats cannot be applied because of missing expected file: '</span> customKcats]);
0061 <span class="keyword">end</span>
0062 
0063 <span class="keyword">if</span> isfile(customKcats)
0064     fID = fopen(customKcats, <span class="string">'r'</span>);
0065     fileContent = textscan(fID, <span class="string">'%s %s %s %f %q %s %s'</span>, <span class="string">'Delimiter'</span>, <span class="string">'\t'</span>, <span class="string">'HeaderLines'</span>, 1);
0066     fclose(fID);
0067     clear customKcats
0068     customKcats.proteins    = fileContent{1};
0069     customKcats.genes       = fileContent{2};
0070     customKcats.gene_name   = fileContent{3};
0071     customKcats.kcat        = fileContent{4};
0072     customKcats.rxns        = fileContent{5};
0073     customKcats.notes       = fileContent{6};
0074     customKcats.stoicho     = fileContent{7};
0075 <span class="keyword">elseif</span> ~all(strcmp(fieldnames(customKcats),{<span class="string">'proteins'</span>,<span class="string">'kcat'</span>,<span class="string">'notes'</span>,<span class="string">'stoicho'</span>}))
0076     error([<span class="string">'The customKcats file at '</span> customKcats <span class="string">' does not have all the required fields in the header.'</span>]);
0077 <span class="keyword">end</span>
0078 
0079 rxnToUpdate = false(length(model.ec.rxns),1);
0080 rxnNotMatch = false(length(model.ec.rxns),1);
0081 evaluatedRule = cell(length(model.ec.rxns),1);
0082 enzInModel = cell(length(model.ec.rxns),1);
0083 ecRxnNoSuffix = regexprep(model.ec.rxns,<span class="string">'_EXP_\d+$'</span>,<span class="string">''</span>);
0084 
0085 <span class="comment">% Implementation for full GECKO formulation</span>
0086 <span class="keyword">if</span> ~model.ec.geckoLight
0087     <span class="keyword">for</span> i = 1:numel(customKcats.proteins)
0088         <span class="keyword">if</span> isempty(customKcats.proteins{i})
0089             <span class="comment">%If only reaction ID(s) is/are specified (and no proteins),</span>
0090             <span class="comment">%then apply the kcat to all isoenzymic reactions</span>
0091             rxns    = strtrim(strsplit(customKcats.rxns{i}, <span class="string">','</span>));
0092             rxnIdxs = contains(ecRxnNoSuffix,rxns);
0093             rxnToUpdate(rxnIdxs) = 1;
0094             model.ec.kcat(rxnIdxs) = customKcats.kcat(i);
0095         <span class="keyword">else</span>
0096             prots = strtrim(strsplit(customKcats.proteins{i}, <span class="string">'+'</span>));
0097 
0098             <span class="comment">% Find the index for the enzymes which kcat will be changed. In</span>
0099             <span class="comment">% case the protein is not in the model generate a warning.</span>
0100             <span class="keyword">try</span>
0101                 enzIdx = cellfun(@(x) find(strcmpi(model.ec.enzymes, x)), prots);
0102             <span class="keyword">catch</span>
0103                 enzIdx = [];
0104                 disp( [<span class="string">'Protein(s) '</span> customKcats.proteins{i} <span class="string">' were not found in the model.'</span>]);
0105             <span class="keyword">end</span>
0106 
0107             <span class="comment">% if not specific reactions are defined, find all the reaction</span>
0108             <span class="comment">% index where the enzyme is used</span>
0109             <span class="keyword">if</span> isempty(customKcats.rxns{i})
0110                 temp_rxnIdxs = arrayfun(@(x) find(model.ec.rxnEnzMat(:, x)), enzIdx, <span class="string">'UniformOutput'</span>, false);
0111                 <span class="comment">% otherwhise, If a set of reactions if defined, only get the index for those</span>
0112                 <span class="comment">% but ignore any _EXP_ suffixes</span>
0113             <span class="keyword">else</span>
0114                 rxns = strtrim(strsplit(customKcats.rxns{i}, <span class="string">','</span>));
0115                 temp_rxnIdxs = arrayfun(@(x) find(strcmpi(ecRxnNoSuffix, x)), rxns, <span class="string">'UniformOutput'</span>, false);
0116             <span class="keyword">end</span>
0117 
0118             <span class="keyword">if</span> ~isempty(temp_rxnIdxs)
0119                 rxnIdxs = [];
0120                 <span class="keyword">for</span> j = 1:numel(temp_rxnIdxs)
0121                     rxnIdxs = [rxnIdxs; temp_rxnIdxs{j}];
0122                 <span class="keyword">end</span>
0123 
0124                 <span class="comment">% Check when multiple proteins are involved, since it can return same rxn n times</span>
0125                 rxnIdxs = unique(rxnIdxs); <span class="comment">%unique(rxnIdxs{1, :});</span>
0126 
0127                 <span class="keyword">for</span> j = 1:numel(rxnIdxs)
0128                     <span class="comment">% Get all the enzymes involved in the reaction</span>
0129                     allEnzInRxn = find(model.ec.rxnEnzMat(rxnIdxs(j),:));
0130 
0131                     C = intersect(enzIdx, allEnzInRxn);
0132 
0133                     <span class="comment">% Determine the match percentage bewteen the rules</span>
0134                     <span class="keyword">if</span> numel(C) == numel(enzIdx) &amp;&amp; numel(C) == numel(allEnzInRxn)
0135                         match = 1;
0136                     <span class="keyword">else</span>
0137                         <span class="keyword">if</span> numel(enzIdx) &lt; numel(allEnzInRxn)
0138                             match = numel(C) / numel(allEnzInRxn);
0139                         <span class="keyword">else</span>
0140                             match = numel(C) / numel(enzIdx);
0141                         <span class="keyword">end</span>
0142                     <span class="keyword">end</span>
0143 
0144                     <span class="comment">% Update the kcat value stored in the model, if match 100%,</span>
0145                     <span class="comment">% otherwhise if &gt;= 0.5 inform to the user to be validated</span>
0146                     <span class="keyword">if</span> match == 1
0147                         rxnToUpdate(rxnIdxs(j)) = 1;
0148                         model.ec.kcat(rxnIdxs(j)) = customKcats.kcat(i);
0149 
0150                         <span class="comment">% Add note mentioning manual kcat change</span>
0151                         model.ec.source{rxnIdxs(j),1} = <span class="string">'custom'</span>;
0152                         <span class="keyword">if</span>  isempty(model.ec.notes{rxnIdxs(j), 1}) &amp;&amp; isfield(customKcats,<span class="string">'notes'</span>) &amp;&amp; ~isempty(customKcats.notes{i})
0153                             model.ec.notes{rxnIdxs(j), 1} = customKcats.notes{i};
0154                         <span class="keyword">else</span>
0155                             model.ec.notes{rxnIdxs(j), 1} = [model.ec.notes{rxnIdxs(j), 1} <span class="string">', '</span> customKcats.notes{i}];
0156                         <span class="keyword">end</span>
0157                     <span class="keyword">elseif</span> match &gt;= 0.5 &amp;&amp; match &lt; 1
0158                         rxnNotMatch(rxnIdxs(j)) = 1;
0159                         evaluatedRule{rxnIdxs(j), 1} = customKcats.proteins{i};
0160                         enzInModel{rxnIdxs(j), 1} = strjoin(model.ec.enzymes(allEnzInRxn), <span class="string">' + '</span>);
0161                     <span class="keyword">end</span>
0162                 <span class="keyword">end</span>
0163             <span class="keyword">end</span>
0164         <span class="keyword">end</span>
0165     <span class="keyword">end</span>
0166 
0167     <span class="comment">% Apply the new kcat values to the model</span>
0168     <span class="keyword">if</span> ~isempty(find(rxnToUpdate, 1))
0169         model = <a href="applyKcatConstraints.html" class="code" title="function model = applyKcatConstraints(model,updateRxns)">applyKcatConstraints</a>(model, rxnToUpdate);
0170     <span class="keyword">else</span>
0171         disp(<span class="string">'No matches found. Consider checking the IDs or proteins in customKcats.'</span>)
0172     <span class="keyword">end</span>
0173 
0174     rxnUpdated = model.ec.rxns(find(rxnToUpdate));
0175 
0176     <span class="comment">% Remove from notMatch those reactions already updated</span>
0177     remove = and(rxnToUpdate, rxnNotMatch);
0178     rxnNotMatch(remove) = 0;
0179     evaluatedRule(remove) = <span class="string">''</span>;
0180     enzInModel(remove) = <span class="string">''</span>;
0181 
0182     idRxns = model.ec.rxns(find(rxnNotMatch));
0183     fullIdx = cellfun(@(x) find(strcmpi(model.rxns, x)), idRxns);
0184     rxnsNames = model.rxnNames(fullIdx);
0185     evaluatedRule = evaluatedRule(~cellfun(<span class="string">'isempty'</span>, evaluatedRule));
0186     enzInModel = enzInModel(~cellfun(<span class="string">'isempty'</span>, enzInModel));
0187     rules = model.grRules(fullIdx);
0188     notMatch = table(idRxns, rxnsNames, evaluatedRule, enzInModel, rules, <span class="keyword">...</span>
0189         <span class="string">'VariableNames'</span>,{<span class="string">'rxns'</span>, <span class="string">'name'</span>, <span class="string">'custom enzymes'</span>, <span class="string">'enzymes in model'</span>, <span class="string">'rules'</span>});
0190 <span class="keyword">end</span>
0191 <span class="keyword">end</span></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>